# Manual Testing Checklist - Real Mode Deployment

**Date**: 2025-11-06
**Environment**: Development with Real API Integration
**Purpose**: Comprehensive manual testing after switching from mock mode to real transaction mode

## Configuration Changes Summary

### API Mock Mode Status
- ✅ **Circle API**: Mock mode DISABLED - Using real Circle API
- ✅ **WhiteBit API**: Mock mode DISABLED - Using real WhiteBit API
- ✅ **1inch DEX**: Mock mode DISABLED - Using real 1inch aggregator on Polygon Amoy testnet

### Required Credentials
Before testing, ensure the following credentials are configured:

1. **Circle API** (CoinPay.Api/appsettings.Development.json:40-42)
   - `ApiKey`: Format `TEST_API_KEY:KEY_ID:SECRET`
   - `EntitySecret`: Your actual Circle entity secret
   - `AppId`: Your Circle application ID
   - Get credentials from: https://console.circle.com

2. **1inch API** (CoinPay.Api/appsettings.json:60)
   - `ApiKey`: Your real 1inch API key
   - Get API key from: https://portal.1inch.dev/
   - Network: Polygon Amoy testnet (ChainId 80002)

3. **WhiteBit API** (User-provided)
   - Users must connect their own WhiteBit accounts
   - API key and secret are stored encrypted per user

## Prerequisites Verification

### System Status
- [ ] All Docker containers running (6 containers):
  - coinpay-postgres (healthy)
  - coinpay-vault (healthy)
  - coinpay-api (running on port 7777)
  - coinpay-web (running on port 3000)
  - coinpay-gateway (running on port 5000)
  - coinpay-docfx (running on port 8080)

- [ ] Database migrations applied successfully
- [ ] No critical errors in API logs (check: `docker logs coinpay-api`)
- [ ] Vault secrets loaded (0 secrets is expected if vault was reset)

### Test Data Cleanup
⚠️ **IMPORTANT**: Old mock transaction data will fail in real mode

- [ ] Check database for mock Circle transaction IDs:
  ```sql
  SELECT * FROM "Transactions"
  WHERE "CircleTransactionId" LIKE 'mock-circle-tx-%';
  ```
  Expected: Transactions with IDs:
  - `mock-circle-tx-a59f3c10faed` (Transaction 4)
  - `mock-circle-tx-b1313eedf27f` (Transaction 5)
  - `mock-circle-tx-dbaa609ca2b9` (Transaction 6)

- [ ] These transactions will show monitoring errors (expected behavior)
- [ ] Consider archiving or deleting mock transactions before production testing

## Manual Test Scenarios

### 1. Authentication & User Management

#### 1.1 User Registration (Real Circle API)
- [ ] Navigate to http://localhost:3000/register
- [ ] Enter new username
- [ ] Verify passkey challenge is generated by real Circle API
- [ ] Complete registration with passkey
- [ ] **Expected**: Real wallet created on Circle platform
- [ ] **Expected**: User record created in database with real Circle User ID
- [ ] **Verify**: Check Circle console for new user

#### 1.2 User Login
- [ ] Navigate to http://localhost:3000/login
- [ ] Enter existing username
- [ ] Complete passkey authentication
- [ ] **Expected**: JWT token issued
- [ ] **Expected**: Redirected to dashboard
- [ ] **Verify**: Token includes real user GUID

### 2. Wallet Operations (Real Circle Transfers)

⚠️ **CAUTION**: Real blockchain transactions will be executed

#### 2.1 Create Deposit Transaction
- [ ] Navigate to Wallet page
- [ ] Click "Receive" or "Deposit"
- [ ] Generate deposit address
- [ ] **Expected**: Real Circle wallet address provided
- [ ] **Expected**: QR code generated
- [ ] **Test with small amount**: Send test USDC from external wallet
- [ ] **Verify**: Transaction appears in Circle console
- [ ] **Verify**: Transaction monitoring service picks up status changes

#### 2.2 Create Withdrawal Transaction
- [ ] Ensure wallet has sufficient balance (test USDC on Polygon Amoy)
- [ ] Navigate to Wallet page
- [ ] Click "Send" or "Withdraw"
- [ ] Enter:
  - Destination address (use a test wallet you control)
  - Amount (use small test amount, e.g., 0.1 USDC)
  - Currency: USDC
- [ ] Confirm transaction
- [ ] **Expected**: Real Circle API call initiated
- [ ] **Expected**: Transaction ID returned (format: real Circle transaction ID)
- [ ] **Expected**: Transaction status: "Pending"
- [ ] **Monitor**: Background service updates status every 30 seconds
- [ ] **Verify**: Transaction completes on Polygon Amoy testnet
- [ ] **Verify**: Check transaction on PolygonScan

#### 2.3 Transaction History
- [ ] View transaction history
- [ ] **Expected**: Real transaction data displayed
- [ ] **Expected**: No mock transaction IDs (mock-circle-tx-*)
- [ ] Filter by status: Pending, Completed, Failed
- [ ] **Verify**: Timestamps accurate
- [ ] **Verify**: Amounts match blockchain records

### 3. Bank Account & Fiat Gateway (Real Circle Payouts)

⚠️ **CAUTION**: Real bank payouts will be initiated if testing with production Circle credentials

#### 3.1 Add Bank Account
- [ ] Navigate to Bank Accounts page
- [ ] Click "Add Bank Account"
- [ ] Enter:
  - Bank name
  - Account holder name
  - Account number
  - Routing number (US) or IBAN (International)
- [ ] Submit
- [ ] **Expected**: Bank account validation via Circle
- [ ] **Expected**: Account status: "Pending" or "Verified"
- [ ] **Verify**: Check Circle console for bank account record

#### 3.2 Create Payout (⚠️ Use Test Mode if Available)
- [ ] Ensure verified bank account exists
- [ ] Navigate to Payouts page
- [ ] Click "Create Payout"
- [ ] Enter:
  - Select bank account
  - Amount (use minimum test amount)
  - Currency: USD
- [ ] Confirm payout
- [ ] **Expected**: Real Circle payout API called
- [ ] **Expected**: Payout ID returned
- [ ] **Expected**: Status: "Pending"
- [ ] **Monitor**: Status updates via webhook or polling
- [ ] **Verify**: Payout appears in Circle console

⚠️ **NOTE**: If using real Circle production credentials, real money will be transferred to the bank account. Use Circle's sandbox/test environment for testing.

### 4. DEX Swap (Real 1inch Transactions)

⚠️ **CAUTION**: Real on-chain swaps will be executed on Polygon Amoy testnet

#### 4.1 Get Swap Quote
- [ ] Navigate to Swap page
- [ ] Select tokens:
  - From: USDC
  - To: USDT
- [ ] Enter amount (use small test amount)
- [ ] **Expected**: Real quote from 1inch API
- [ ] **Expected**: Quote includes:
  - Exchange rate
  - Minimum received (with slippage)
  - Platform fee (0.5%)
  - Gas estimates
- [ ] **Verify**: Quote expires after 30 seconds (cache TTL)
- [ ] **Verify**: New quotes have different prices if market moves

#### 4.2 Execute Swap
- [ ] Continue from valid quote
- [ ] Review swap details
- [ ] Confirm swap
- [ ] **Expected**: Real on-chain transaction submitted via 1inch
- [ ] **Expected**: Transaction hash returned
- [ ] **Expected**: Swap status: "Pending"
- [ ] **Monitor**: Transaction confirmation on blockchain
- [ ] **Verify**: Check transaction on PolygonScan
- [ ] **Verify**: Tokens swapped in wallet balance
- [ ] **Verify**: Platform fee collected to treasury wallet

#### 4.3 Swap History
- [ ] View swap history
- [ ] **Expected**: Real transaction data
- [ ] **Expected**: Blockchain transaction hashes (not mock IDs)
- [ ] Click on swap to view details
- [ ] **Verify**: All fields populated correctly
- [ ] **Verify**: Links to PolygonScan work

### 5. Exchange Investment (Real WhiteBit Integration)

⚠️ **CAUTION**: Real investment positions will be created on WhiteBit exchange

#### 5.1 Connect WhiteBit Account
- [ ] Navigate to Investment page
- [ ] Click "Connect Exchange"
- [ ] Select "WhiteBit"
- [ ] Enter API credentials:
  - API Key (from WhiteBit account)
  - API Secret
- [ ] Submit
- [ ] **Expected**: Real WhiteBit API validation
- [ ] **Expected**: Connection status: "Connected"
- [ ] **Expected**: API credentials encrypted and stored
- [ ] **Verify**: Test connection with "Test Connection" button
- [ ] **Expected**: Real account balance fetched from WhiteBit

#### 5.2 Browse Investment Plans
- [ ] View available investment plans
- [ ] **Expected**: Real plans from WhiteBit staking API
- [ ] **Expected**: Accurate APY rates
- [ ] **Expected**: Correct minimum/maximum amounts
- [ ] **Expected**: Real terms and conditions
- [ ] Filter by:
  - Currency (USDT, BTC, ETH)
  - APY range
  - Duration
- [ ] **Verify**: Plans match WhiteBit website

#### 5.3 Create Investment Position
- [ ] Select an investment plan
- [ ] Enter amount (use minimum allowed amount)
- [ ] Review projected returns
- [ ] Confirm investment
- [ ] **Expected**: Real staking position created on WhiteBit
- [ ] **Expected**: Position ID returned from WhiteBit
- [ ] **Expected**: Status: "Active"
- [ ] **Expected**: Start date: Current date
- [ ] **Verify**: Position appears in WhiteBit exchange account
- [ ] **Verify**: Amount deducted from WhiteBit spot balance

#### 5.4 Monitor Investment Position
- [ ] View investment dashboard
- [ ] **Expected**: Real-time position data from WhiteBit
- [ ] **Expected**: Accurate current value
- [ ] **Expected**: Accrued rewards calculated correctly
- [ ] **Expected**: Projected earnings match APY
- [ ] Wait 30 seconds for auto-sync
- [ ] **Verify**: Position data refreshed from WhiteBit API

#### 5.5 Close Investment Position (Optional)
⚠️ **NOTE**: This will close a real investment position
- [ ] Select active position
- [ ] Click "Close Position"
- [ ] Confirm closure
- [ ] **Expected**: Position closed on WhiteBit
- [ ] **Expected**: Funds returned to WhiteBit spot balance
- [ ] **Expected**: Final rewards calculated
- [ ] **Verify**: Position status: "Closed"
- [ ] **Verify**: Transaction recorded in history

### 6. Security & Error Handling

#### 6.1 Authentication Security
- [ ] Attempt to access protected endpoints without JWT
- [ ] **Expected**: 401 Unauthorized
- [ ] Attempt to access another user's resources
- [ ] **Expected**: 404 Not Found (ownership validation)
- [ ] Test JWT expiration (default: 24 hours)
- [ ] **Expected**: Token refresh required after expiration

#### 6.2 Rate Limiting
- [ ] Make multiple rapid requests to:
  - POST /api/auth/login (limit: 5/minute)
  - POST /api/swap/execute (limit: 5/minute)
  - GET /api/swap/quote (limit: 30/minute)
- [ ] **Expected**: HTTP 429 Too Many Requests after limit
- [ ] **Expected**: Retry-After header included

#### 6.3 API Error Handling
- [ ] Test with invalid Circle API key
- [ ] **Expected**: Error logged, user-friendly message
- [ ] Test with insufficient balance
- [ ] **Expected**: 400 Bad Request with clear message
- [ ] Test with invalid 1inch swap parameters
- [ ] **Expected**: Quote fails with descriptive error
- [ ] Test with invalid WhiteBit credentials
- [ ] **Expected**: Connection fails, credentials not stored

#### 6.4 Input Validation
- [ ] Submit transaction with negative amount
- [ ] **Expected**: 400 Bad Request
- [ ] Submit swap with slippage > 50%
- [ ] **Expected**: Validation error
- [ ] Submit payout below minimum amount
- [ ] **Expected**: Error message with minimum amount

### 7. Performance Testing

#### 7.1 Response Caching
- [ ] Make GET request to /api/transactions
- [ ] Check response headers for X-Cache: HIT/MISS
- [ ] Make same request within 30 seconds
- [ ] **Expected**: X-Cache: HIT (cached response)
- [ ] **Expected**: Faster response time (< 50ms)

#### 7.2 Database Performance
- [ ] Query transactions with large dataset
- [ ] **Expected**: Results returned in < 500ms
- [ ] **Verify**: Database indexes being used
- [ ] Check with EXPLAIN ANALYZE:
  ```sql
  EXPLAIN ANALYZE
  SELECT * FROM "Transactions"
  WHERE "UserId" = 'user-guid'
  AND "CreatedAt" > NOW() - INTERVAL '30 days'
  ORDER BY "CreatedAt" DESC;
  ```
- [ ] **Expected**: Index scan, not sequential scan

#### 7.3 Background Services
- [ ] Monitor transaction status updates
- [ ] **Expected**: Updates every 30 seconds
- [ ] Check investment position sync
- [ ] **Expected**: Sync every 60 seconds
- [ ] **Verify**: No memory leaks over time
- [ ] **Verify**: Log file size manageable

### 8. Frontend Testing

#### 8.1 Onboarding Wizard (New Feature - Sprint N06)
- [ ] Create new user account
- [ ] **Expected**: Onboarding wizard appears
- [ ] Complete all 3 steps:
  1. Welcome step
  2. Wallet setup
  3. Feature tour
- [ ] **Expected**: Progress indicator shows current step
- [ ] **Expected**: Can navigate forward/backward
- [ ] **Expected**: Wizard dismissed after completion

#### 8.2 Help Center (New Feature - Sprint N06)
- [ ] Navigate to Help page
- [ ] Search for "swap"
- [ ] **Expected**: Relevant FAQs filtered
- [ ] Click on FAQ item
- [ ] **Expected**: Answer expands/collapses
- [ ] Filter by category (Wallet, Swap, Investment)
- [ ] **Expected**: FAQs filtered correctly

#### 8.3 Accessibility (New - Sprint N06)
- [ ] Test keyboard navigation:
  - Tab through all interactive elements
  - Enter/Space to activate buttons
  - Escape to close modals
- [ ] **Expected**: Visible focus indicators
- [ ] **Expected**: Logical tab order
- [ ] Test with screen reader (NVDA/JAWS)
- [ ] **Expected**: All elements announced correctly
- [ ] **Expected**: ARIA labels present
- [ ] Test "Skip to main content" link
- [ ] **Expected**: Focus jumps to main content area

#### 8.4 Build Optimization (Sprint N06)
- [ ] Open browser dev tools
- [ ] Check Network tab
- [ ] **Expected**: Initial bundle < 500 KB
- [ ] **Expected**: Lazy-loaded routes load on demand
- [ ] **Expected**: react-vendor chunk: ~219 KB
- [ ] **Expected**: Main bundle: ~198 KB
- [ ] **Expected**: UI vendor: ~60 KB

### 9. Cross-Browser Testing

Test on the following browsers:

#### 9.1 Chrome (Latest)
- [ ] All features functional
- [ ] Performance acceptable
- [ ] No console errors

#### 9.2 Firefox (Latest)
- [ ] All features functional
- [ ] Passkey authentication works
- [ ] No compatibility issues

#### 9.3 Safari (macOS/iOS)
- [ ] All features functional
- [ ] Passkey authentication works
- [ ] CSS rendering correct

#### 9.4 Edge (Latest)
- [ ] All features functional
- [ ] Performance acceptable
- [ ] No console errors

## Known Issues in Real Mode

### Expected Errors
1. **Mock Transaction Monitoring Failures**
   - Error: "Circle API request failed...Resource not found"
   - Cause: Old mock transaction IDs (mock-circle-tx-*) in database
   - Impact: Background monitoring service logs errors every 30 seconds
   - Resolution: Archive or delete mock transactions from database

2. **Vault Secrets Not Loaded**
   - Warning: "No secrets loaded from Vault"
   - Cause: Vault container reset during deployment
   - Impact: Secrets must be configured in appsettings files instead
   - Resolution: Re-initialize Vault with production secrets

3. **Missing Real API Credentials**
   - Various 401/403 errors from Circle, 1inch, WhiteBit
   - Cause: Placeholder API keys in configuration
   - Impact: API calls will fail until real credentials provided
   - Resolution: Update appsettings with real API keys

### Configuration Checklist
Before full manual testing, update these files:

1. **CoinPay.Api/appsettings.Development.json**
   - Line 40: Circle ApiKey (real key from Circle console)
   - Line 41: Circle EntitySecret (real secret)
   - Line 42: Circle AppId (real app ID)

2. **CoinPay.Api/appsettings.json**
   - Line 60: OneInch ApiKey (real key from 1inch portal)

3. **Environment Variables** (Optional - if using Vault)
   - Restore Vault secrets for production deployment

## Test Data Requirements

### Test Wallets
- Create at least 2 test user accounts for testing
- Fund wallets with test USDC on Polygon Amoy:
  - Get test USDC from faucet: https://faucet.circle.com
  - Minimum balance: 10 USDC per wallet

### Test Bank Accounts
- Use Circle's test bank accounts (sandbox mode)
- Do NOT use real bank accounts for testing
- Test account numbers available in Circle documentation

### Test Exchange Accounts
- Create WhiteBit sandbox/demo account if available
- Do NOT use production WhiteBit account with real funds
- Use API key with read-only permissions for initial testing

## Regression Testing Summary

### Backend Tests
- Unit tests: ❌ Compilation errors (pre-existing, not related to mock mode changes)
  - Error: Missing IJwtTokenService interface
  - Resolution: Tests need updating to use JwtTokenService concrete class
- Integration tests: ✅ Build successful (not executed due to real mode)
- Manual API tests: ⏳ Pending (requires real credentials)

### Frontend Tests
- Build: ✅ Successful (477 KB optimized bundle)
- E2E tests: ⏳ Pending (Playwright tests require running application)
- Manual UI tests: ⏳ Pending (see checklist above)

### Security Tests
- Authentication: ⏳ Pending validation
- Authorization: ⏳ Pending validation
- Input validation: ⏳ Pending validation
- OWASP Top 10: ⏳ Pending scan

## Manual Testing Sign-off

### Tester Information
- **Tester Name**: ___________________________
- **Test Date**: ___________________________
- **Environment**: Development (Real Mode)
- **Test Duration**: ___________________________

### Test Results Summary
- Total Test Cases: 90+
- Passed: _________
- Failed: _________
- Blocked: _________
- Notes: _________________________________________

### Critical Issues Found
| Issue ID | Severity | Description | Status |
|----------|----------|-------------|--------|
|          |          |             |        |
|          |          |             |        |
|          |          |             |        |

### Approval
- [ ] All critical test cases passed
- [ ] All high-priority issues resolved or documented
- [ ] Performance acceptable for production
- [ ] Security vulnerabilities addressed
- [ ] Ready for production deployment

**Approved By**: ___________________________
**Date**: ___________________________
**Signature**: ___________________________

## Next Steps

### If All Tests Pass
1. Tag release: `git tag v1.0.0-beta`
2. Deploy to staging environment
3. Conduct UAT (User Acceptance Testing)
4. Prepare production deployment

### If Tests Fail
1. Document all failures in issues tracker
2. Prioritize critical bugs
3. Assign to development team
4. Re-test after fixes
5. Update this checklist with results

## References
- Sprint N06 Master Plan: `Planning/Sprints/N06/Sprint-06-Master-Plan.md`
- QA Test Plan: `Testing/QA/QA-601-Phase-6-Master-Test-Plan.md`
- E2E Test Scenarios: `Testing/QA/QA-603-E2E-Test-Scenarios.md`
- Security Testing Report: `Testing/QA/QA-602-Security-Testing-Report.md`

---

**Document Version**: 1.0
**Last Updated**: 2025-11-06
**Status**: Ready for Manual Testing
